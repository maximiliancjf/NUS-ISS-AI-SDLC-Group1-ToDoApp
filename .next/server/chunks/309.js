"use strict";exports.id=309,exports.ids=[309],exports.modules={787:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return i}});let d=function(a,b){if(a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=e(b);if(c&&c.has(a))return c.get(a);var d={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in a)if("default"!==g&&Object.prototype.hasOwnProperty.call(a,g)){var h=f?Object.getOwnPropertyDescriptor(a,g):null;h&&(h.get||h.set)?Object.defineProperty(d,g,h):d[g]=a[g]}return d.default=a,c&&c.set(a,d),d}(c(4515));function e(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(e=function(a){return a?c:b})(a)}let f={current:null},g="function"==typeof d.cache?d.cache:a=>a,h=console.warn;function i(a){return function(...b){h(a(...b))}}g(a=>{try{h(f.current)}finally{f.current=null}})},3535:(a,b,c)=>{let d=c(3033),e=c(9294),f=c(6906),g=c(787),h=c(1938),i=c(9168),j=c(9290);c(3036);new WeakMap;(0,g.createDedupedByCallsiteServerErrorLoggerDev)(function(a,b){let c=a?`Route "${a}" `:"This route ";return Object.defineProperty(Error(`${c}used ${b}. \`draftMode()\` should be awaited before using its value. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E377",enumerable:!1,configurable:!0})})},4230:(a,b,c)=>{Object.defineProperty(b,"U",{enumerable:!0,get:function(){return n}});let d=c(8706),e=c(3675),f=c(9294),g=c(3033),h=c(6906),i=c(1938),j=c(2831),k=c(787),l=c(1716),m=c(9290);function n(){let a="cookies",b=f.workAsyncStorage.getStore(),c=g.workUnitAsyncStorage.getStore();if(b){if(c&&"after"===c.phase&&!(0,l.isRequestAPICallableInsideAfter)())throw Object.defineProperty(Error(`Route ${b.route} used "cookies" inside "after(...)". This is not supported. If you need this data inside an "after" callback, use "cookies" outside of the callback. See more info here: https://nextjs.org/docs/canary/app/api-reference/functions/after`),"__NEXT_ERROR_CODE",{value:"E88",enumerable:!1,configurable:!0});if(b.forceStatic)return p(d.RequestCookiesAdapter.seal(new e.RequestCookies(new Headers({}))));if(b.dynamicShouldError)throw Object.defineProperty(new i.StaticGenBailoutError(`Route ${b.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`cookies\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E549",enumerable:!1,configurable:!0});if(c)switch(c.type){case"cache":let f=Object.defineProperty(Error(`Route ${b.route} used "cookies" inside "use cache". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use "cookies" outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E398",enumerable:!1,configurable:!0});throw Error.captureStackTrace(f,n),b.invalidDynamicUsageError??=f,f;case"unstable-cache":throw Object.defineProperty(Error(`Route ${b.route} used "cookies" inside a function cached with "unstable_cache(...)". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use "cookies" outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`),"__NEXT_ERROR_CODE",{value:"E157",enumerable:!1,configurable:!0});case"prerender":var k=b,q=c;let g=o.get(q);if(g)return g;let r=(0,j.makeHangingPromise)(q.renderSignal,k.route,"`cookies()`");return o.set(q,r),r;case"prerender-client":let s="`cookies`";throw Object.defineProperty(new m.InvariantError(`${s} must not be used within a client component. Next.js should be preventing ${s} from being included in client components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E693",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,h.postponeWithTracking)(b.route,a,c.dynamicTracking);case"prerender-legacy":return(0,h.throwToInterruptStaticGeneration)(a,b,c);case"prerender-runtime":return(0,h.delayUntilRuntimeStage)(c,function(a){let b=o.get(a);if(b)return b;let c=Promise.resolve(a);return o.set(a,c),c}(c.cookies));case"private-cache":return p(c.cookies);case"request":return(0,h.trackDynamicDataInDynamicRender)(c),p((0,d.areCookiesMutableInCurrentPhase)(c)?c.userspaceMutableCookies:c.cookies)}}(0,g.throwForMissingRequestStore)(a)}c(3036);let o=new WeakMap;function p(a){let b=o.get(a);if(b)return b;let c=Promise.resolve(a);return o.set(a,c),Object.defineProperties(c,{[Symbol.iterator]:{value:a[Symbol.iterator]?a[Symbol.iterator].bind(a):q.bind(a)},size:{get:()=>a.size},get:{value:a.get.bind(a)},getAll:{value:a.getAll.bind(a)},has:{value:a.has.bind(a)},set:{value:a.set.bind(a)},delete:{value:a.delete.bind(a)},clear:{value:"function"==typeof a.clear?a.clear.bind(a):r.bind(a,c)},toString:{value:a.toString.bind(a)}}),c}function q(){return this.getAll().map(a=>[a.name,a]).values()}function r(a){for(let a of this.getAll())this.delete(a.name);return a}(0,k.createDedupedByCallsiteServerErrorLoggerDev)(function(a,b){let c=a?`Route "${a}" `:"This route ";return Object.defineProperty(Error(`${c}used ${b}. \`cookies()\` should be awaited before using its value. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E223",enumerable:!1,configurable:!0})})},4603:(a,b,c)=>{let d=c(7675),e=c(9294),f=c(3033),g=c(6906),h=c(1938),i=c(2831),j=c(787),k=c(1716),l=c(9290);c(3036);new WeakMap;(0,j.createDedupedByCallsiteServerErrorLoggerDev)(function(a,b){let c=a?`Route "${a}" `:"This route ";return Object.defineProperty(Error(`${c}used ${b}. \`headers()\` should be awaited before using its value. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E277",enumerable:!1,configurable:!0})})},6802:(a,b,c)=>{c.d(b,{UL:()=>d.U});var d=c(4230);c(4603),c(3535)},8706:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),!function(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(b,{MutableRequestCookiesAdapter:function(){return l},ReadonlyRequestCookiesError:function(){return g},RequestCookiesAdapter:function(){return h},appendMutableCookies:function(){return k},areCookiesMutableInCurrentPhase:function(){return n},createCookiesWithMutableAccessCheck:function(){return m},getModifiedCookieValues:function(){return j},responseCookiesToRequestCookies:function(){return p}});let d=c(3675),e=c(3036),f=c(9294);class g extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#options")}static callable(){throw new g}}class h{static seal(a){return new Proxy(a,{get(a,b,c){switch(b){case"clear":case"delete":case"set":return g.callable;default:return e.ReflectAdapter.get(a,b,c)}}})}}let i=Symbol.for("next.mutated.cookies");function j(a){let b=a[i];return b&&Array.isArray(b)&&0!==b.length?b:[]}function k(a,b){let c=j(b);if(0===c.length)return!1;let e=new d.ResponseCookies(a),f=e.getAll();for(let a of c)e.set(a);for(let a of f)e.set(a);return!0}class l{static wrap(a,b){let c=new d.ResponseCookies(new Headers);for(let b of a.getAll())c.set(b);let g=[],h=new Set,j=()=>{let a=f.workAsyncStorage.getStore();if(a&&(a.pathWasRevalidated=!0),g=c.getAll().filter(a=>h.has(a.name)),b){let a=[];for(let b of g){let c=new d.ResponseCookies(new Headers);c.set(b),a.push(c.toString())}b(a)}},k=new Proxy(c,{get(a,b,c){switch(b){case i:return g;case"delete":return function(...b){h.add("string"==typeof b[0]?b[0]:b[0].name);try{return a.delete(...b),k}finally{j()}};case"set":return function(...b){h.add("string"==typeof b[0]?b[0]:b[0].name);try{return a.set(...b),k}finally{j()}};default:return e.ReflectAdapter.get(a,b,c)}}});return k}}function m(a){let b=new Proxy(a.mutableCookies,{get(c,d,f){switch(d){case"delete":return function(...d){return o(a,"cookies().delete"),c.delete(...d),b};case"set":return function(...d){return o(a,"cookies().set"),c.set(...d),b};default:return e.ReflectAdapter.get(c,d,f)}}});return b}function n(a){return"action"===a.phase}function o(a,b){if(!n(a))throw new g}function p(a){let b=new d.RequestCookies(new Headers);for(let c of a.getAll())b.set(c);return b}},9594:(a,b,c)=>{c.d(b,{Pl:()=>ab,Vv:()=>Y});var d=c(4573),e=c(7598);let f=new TextEncoder,g=new TextDecoder;function h(...a){let b=new Uint8Array(a.reduce((a,{length:b})=>a+b,0)),c=0;return a.forEach(a=>{b.set(a,c),c+=a.length}),b}let i=a=>d.Buffer.from(a).toString("base64url"),j=a=>new Uint8Array(d.Buffer.from(function(a){let b=a;return b instanceof Uint8Array&&(b=g.decode(b)),b}(a),"base64"));class k extends Error{static get code(){return"ERR_JOSE_GENERIC"}code="ERR_JOSE_GENERIC";constructor(a){super(a),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class l extends k{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;constructor(a,b="unspecified",c="unspecified"){super(a),this.claim=b,this.reason=c}}class m extends k{static get code(){return"ERR_JWT_EXPIRED"}code="ERR_JWT_EXPIRED";claim;reason;constructor(a,b="unspecified",c="unspecified"){super(a),this.claim=b,this.reason=c}}class n extends k{static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}code="ERR_JOSE_ALG_NOT_ALLOWED"}class o extends k{static get code(){return"ERR_JOSE_NOT_SUPPORTED"}code="ERR_JOSE_NOT_SUPPORTED"}class p extends k{static get code(){return"ERR_JWS_INVALID"}code="ERR_JWS_INVALID"}class q extends k{static get code(){return"ERR_JWT_INVALID"}code="ERR_JWT_INVALID"}Symbol.asyncIterator;class r extends k{static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";message="signature verification failed"}var s=c(7975);let t=a=>s.types.isKeyObject(a),u=e.webcrypto,v=a=>s.types.isCryptoKey(a),w=a=>t(a)||v(a),x=["KeyObject"];function y(a,b,...c){if(c.length>2){let b=c.pop();a+=`one of type ${c.join(", ")}, or ${b}.`}else 2===c.length?a+=`one of type ${c[0]} or ${c[1]}.`:a+=`of type ${c[0]}.`;return null==b?a+=` Received ${b}`:"function"==typeof b&&b.name?a+=` Received function ${b.name}`:"object"==typeof b&&null!=b&&b.constructor&&b.constructor.name&&(a+=` Received an instance of ${b.constructor.name}`),a}(globalThis.CryptoKey||u?.CryptoKey)&&x.push("CryptoKey");let z=(a,...b)=>y("Key must be ",a,...b);function A(a,b,...c){return y(`Key for the ${a} algorithm must be `,b,...c)}function B(a){if("object"!=typeof a||null===a||"[object Object]"!==Object.prototype.toString.call(a))return!1;if(null===Object.getPrototypeOf(a))return!0;let b=a;for(;null!==Object.getPrototypeOf(b);)b=Object.getPrototypeOf(b);return Object.getPrototypeOf(a)===b}new WeakMap,(0,s.promisify)(e.generateKeyPair),(0,s.promisify)(e.pbkdf2),(0,s.deprecate)(()=>e.constants.RSA_PKCS1_PADDING,'The RSA1_5 "alg" (JWE Algorithm) is deprecated and will be removed in the next major revision.');let C=(a,b,c)=>{a.startsWith("HS")||"dir"===a||a.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(a)?((a,b)=>{if(!(b instanceof Uint8Array)){if(!w(b))throw TypeError(A(a,b,...x,"Uint8Array"));if("secret"!==b.type)throw TypeError(`${x.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}})(a,b):((a,b,c)=>{if(!w(b))throw TypeError(A(a,b,...x));if("secret"===b.type)throw TypeError(`${x.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===c&&"public"===b.type)throw TypeError(`${x.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===c&&"public"===b.type)throw TypeError(`${x.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(b.algorithm&&"verify"===c&&"private"===b.type)throw TypeError(`${x.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(b.algorithm&&"encrypt"===c&&"private"===b.type)throw TypeError(`${x.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)})(a,b,c)},D=function(a,b,c,d,e){let f;if(void 0!==e.crit&&void 0===d.crit)throw new a('"crit" (Critical) Header Parameter MUST be integrity protected');if(!d||void 0===d.crit)return new Set;if(!Array.isArray(d.crit)||0===d.crit.length||d.crit.some(a=>"string"!=typeof a||0===a.length))throw new a('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let g of(f=void 0!==c?new Map([...Object.entries(c),...b.entries()]):b,d.crit)){if(!f.has(g))throw new o(`Extension Header Parameter "${g}" is not recognized`);if(void 0===e[g])throw new a(`Extension Header Parameter "${g}" is missing`);if(f.get(g)&&void 0===d[g])throw new a(`Extension Header Parameter "${g}" MUST be integrity protected`)}return new Set(d.crit)};function E(a){switch(a){case"PS256":case"RS256":case"ES256":case"ES256K":return"sha256";case"PS384":case"RS384":case"ES384":return"sha384";case"PS512":case"RS512":case"ES512":return"sha512";case"EdDSA":return;default:throw new o(`alg ${a} is not supported either by JOSE or your javascript runtime`)}}Symbol();let F=(a,b)=>{let{modulusLength:c}=a.asymmetricKeyDetails;if("number"!=typeof c||c<2048)throw TypeError(`${b} requires key modulusLength to be 2048 bits or larger`)},G={padding:e.constants.RSA_PKCS1_PSS_PADDING,saltLength:e.constants.RSA_PSS_SALTLEN_DIGEST},H=new Map([["ES256","P-256"],["ES256K","secp256k1"],["ES384","P-384"],["ES512","P-521"]]);function I(a,b){switch(a){case"EdDSA":if(!["ed25519","ed448"].includes(b.asymmetricKeyType))throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519 or ed448");return b;case"RS256":case"RS384":case"RS512":if("rsa"!==b.asymmetricKeyType)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");return F(b,a),b;case"PS256":case"PS384":case"PS512":if("rsa-pss"===b.asymmetricKeyType){let{hashAlgorithm:c,mgf1HashAlgorithm:d,saltLength:e}=b.asymmetricKeyDetails,f=parseInt(a.slice(-3),10);if(void 0!==c&&(c!==`sha${f}`||d!==c))throw TypeError(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${a}`);if(void 0!==e&&e>f>>3)throw TypeError(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${a}`)}else if("rsa"!==b.asymmetricKeyType)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa or rsa-pss");return F(b,a),{key:b,...G};case"ES256":case"ES256K":case"ES384":case"ES512":{if("ec"!==b.asymmetricKeyType)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ec");let c=((a,b)=>{let c;if(v(a))c=e.KeyObject.from(a);else if(t(a))c=a;else throw TypeError(z(a,...x));if("secret"===c.type)throw TypeError('only "private" or "public" type keys can be used for this operation');switch(c.asymmetricKeyType){case"ed25519":case"ed448":return`Ed${c.asymmetricKeyType.slice(2)}`;case"x25519":case"x448":return`X${c.asymmetricKeyType.slice(1)}`;case"ec":{let a=c.asymmetricKeyDetails.namedCurve;switch(a){case"prime256v1":return"P-256";case"secp384r1":return"P-384";case"secp521r1":return"P-521";case"secp256k1":return"secp256k1";default:throw new o("Unsupported key curve for this operation")}}default:throw TypeError("Invalid asymmetric key type for this operation")}})(b),d=H.get(a);if(c!==d)throw TypeError(`Invalid key curve for the algorithm, its curve must be ${d}, got ${c}`);return{dsaEncoding:"ieee-p1363",key:b}}default:throw new o(`alg ${a} is not supported either by JOSE or your javascript runtime`)}}function J(a,b="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${b} must be ${a}`)}function K(a,b){return a.name===b}function L(a){return parseInt(a.name.slice(4),10)}function M(a,b,c){if(b instanceof Uint8Array){if(!a.startsWith("HS"))throw TypeError(z(b,...x));return(0,e.createSecretKey)(b)}if(b instanceof e.KeyObject)return b;if(v(b))return!function(a,b,...c){switch(b){case"HS256":case"HS384":case"HS512":{if(!K(a.algorithm,"HMAC"))throw J("HMAC");let c=parseInt(b.slice(2),10);if(L(a.algorithm.hash)!==c)throw J(`SHA-${c}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!K(a.algorithm,"RSASSA-PKCS1-v1_5"))throw J("RSASSA-PKCS1-v1_5");let c=parseInt(b.slice(2),10);if(L(a.algorithm.hash)!==c)throw J(`SHA-${c}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!K(a.algorithm,"RSA-PSS"))throw J("RSA-PSS");let c=parseInt(b.slice(2),10);if(L(a.algorithm.hash)!==c)throw J(`SHA-${c}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==a.algorithm.name&&"Ed448"!==a.algorithm.name)throw J("Ed25519 or Ed448");break;case"ES256":case"ES384":case"ES512":{if(!K(a.algorithm,"ECDSA"))throw J("ECDSA");let c=function(a){switch(a){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(b);if(a.algorithm.namedCurve!==c)throw J(c,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}if(c.length&&!c.some(b=>a.usages.includes(b))){let a="CryptoKey does not support this operation, its usages must include ";if(c.length>2){let b=c.pop();a+=`one of ${c.join(", ")}, or ${b}.`}else 2===c.length?a+=`one of ${c[0]} or ${c[1]}.`:a+=`${c[0]}.`;throw TypeError(a)}}(b,a,c),e.KeyObject.from(b);throw TypeError(z(b,...x,"Uint8Array"))}let N=(0,s.promisify)(e.sign),O=async(a,b,c)=>{let d=M(a,b,"sign");if(a.startsWith("HS")){let b=e.createHmac(function(a){switch(a){case"HS256":return"sha256";case"HS384":return"sha384";case"HS512":return"sha512";default:throw new o(`alg ${a} is not supported either by JOSE or your javascript runtime`)}}(a),d);return b.update(c),b.digest()}return N(E(a),c,I(a,d))},P=(0,s.promisify)(e.verify),Q=async(a,b,c,d)=>{let f=M(a,b,"verify");if(a.startsWith("HS")){let b=await O(a,f,d);try{return e.timingSafeEqual(c,b)}catch{return!1}}let g=E(a),h=I(a,f);try{return await P(g,d,h,c)}catch{return!1}},R=(...a)=>{let b,c=a.filter(Boolean);if(0===c.length||1===c.length)return!0;for(let a of c){let c=Object.keys(a);if(!b||0===b.size){b=new Set(c);continue}for(let a of c){if(b.has(a))return!1;b.add(a)}}return!0};async function S(a,b,c){let d,e;if(!B(a))throw new p("Flattened JWS must be an object");if(void 0===a.protected&&void 0===a.header)throw new p('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==a.protected&&"string"!=typeof a.protected)throw new p("JWS Protected Header incorrect type");if(void 0===a.payload)throw new p("JWS Payload missing");if("string"!=typeof a.signature)throw new p("JWS Signature missing or incorrect type");if(void 0!==a.header&&!B(a.header))throw new p("JWS Unprotected Header incorrect type");let i={};if(a.protected)try{let b=j(a.protected);i=JSON.parse(g.decode(b))}catch{throw new p("JWS Protected Header is invalid")}if(!R(i,a.header))throw new p("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let k={...i,...a.header},l=D(p,new Map([["b64",!0]]),c?.crit,i,k),m=!0;if(l.has("b64")&&"boolean"!=typeof(m=i.b64))throw new p('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:o}=k;if("string"!=typeof o||!o)throw new p('JWS "alg" (Algorithm) Header Parameter missing or invalid');let q=c&&((a,b)=>{if(void 0!==b&&(!Array.isArray(b)||b.some(a=>"string"!=typeof a)))throw TypeError(`"${a}" option must be an array of strings`);if(b)return new Set(b)})("algorithms",c.algorithms);if(q&&!q.has(o))throw new n('"alg" (Algorithm) Header Parameter value not allowed');if(m){if("string"!=typeof a.payload)throw new p("JWS Payload must be a string")}else if("string"!=typeof a.payload&&!(a.payload instanceof Uint8Array))throw new p("JWS Payload must be a string or an Uint8Array instance");let s=!1;"function"==typeof b&&(b=await b(i,a),s=!0),C(o,b,"verify");let t=h(f.encode(a.protected??""),f.encode("."),"string"==typeof a.payload?f.encode(a.payload):a.payload);try{d=j(a.signature)}catch{throw new p("Failed to base64url decode the signature")}if(!await Q(o,b,d,t))throw new r;if(m)try{e=j(a.payload)}catch{throw new p("Failed to base64url decode the payload")}else e="string"==typeof a.payload?f.encode(a.payload):a.payload;let u={payload:e};return(void 0!==a.protected&&(u.protectedHeader=i),void 0!==a.header&&(u.unprotectedHeader=a.header),s)?{...u,key:b}:u}async function T(a,b,c){if(a instanceof Uint8Array&&(a=g.decode(a)),"string"!=typeof a)throw new p("Compact JWS must be a string or Uint8Array");let{0:d,1:e,2:f,length:h}=a.split(".");if(3!==h)throw new p("Invalid Compact JWS");let i=await S({payload:e,protected:d,signature:f},b,c),j={payload:i.payload,protectedHeader:i.protectedHeader};return"function"==typeof b?{...j,key:i.key}:j}let U=a=>Math.floor(a.getTime()/1e3),V=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,W=a=>{let b,c=V.exec(a);if(!c||c[4]&&c[1])throw TypeError("Invalid time period format");let d=parseFloat(c[2]);switch(c[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":b=Math.round(d);break;case"minute":case"minutes":case"min":case"mins":case"m":b=Math.round(60*d);break;case"hour":case"hours":case"hr":case"hrs":case"h":b=Math.round(3600*d);break;case"day":case"days":case"d":b=Math.round(86400*d);break;case"week":case"weeks":case"w":b=Math.round(604800*d);break;default:b=Math.round(0x1e187e0*d)}return"-"===c[1]||"ago"===c[4]?-b:b},X=a=>a.toLowerCase().replace(/^application\//,"");async function Y(a,b,c){let d=await T(a,b,c);if(d.protectedHeader.crit?.includes("b64")&&!1===d.protectedHeader.b64)throw new q("JWTs MUST NOT use unencoded payload");let e={payload:((a,b,c={})=>{let d,e,f,h,{typ:i}=c;if(i&&("string"!=typeof a.typ||X(a.typ)!==X(i)))throw new l('unexpected "typ" JWT header value',"typ","check_failed");try{d=JSON.parse(g.decode(b))}catch{}if(!B(d))throw new q("JWT Claims Set must be a top-level JSON object");let{requiredClaims:j=[],issuer:k,subject:n,audience:o,maxTokenAge:p}=c,r=[...j];for(let a of(void 0!==p&&r.push("iat"),void 0!==o&&r.push("aud"),void 0!==n&&r.push("sub"),void 0!==k&&r.push("iss"),new Set(r.reverse())))if(!(a in d))throw new l(`missing required "${a}" claim`,a,"missing");if(k&&!(Array.isArray(k)?k:[k]).includes(d.iss))throw new l('unexpected "iss" claim value',"iss","check_failed");if(n&&d.sub!==n)throw new l('unexpected "sub" claim value',"sub","check_failed");if(o&&(f=d.aud,h="string"==typeof o?[o]:o,"string"==typeof f?!h.includes(f):!(!!Array.isArray(f)&&h.some(Set.prototype.has.bind(new Set(f))))))throw new l('unexpected "aud" claim value',"aud","check_failed");switch(typeof c.clockTolerance){case"string":e=W(c.clockTolerance);break;case"number":e=c.clockTolerance;break;case"undefined":e=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:s}=c,t=U(s||new Date);if((void 0!==d.iat||p)&&"number"!=typeof d.iat)throw new l('"iat" claim must be a number',"iat","invalid");if(void 0!==d.nbf){if("number"!=typeof d.nbf)throw new l('"nbf" claim must be a number',"nbf","invalid");if(d.nbf>t+e)throw new l('"nbf" claim timestamp check failed',"nbf","check_failed")}if(void 0!==d.exp){if("number"!=typeof d.exp)throw new l('"exp" claim must be a number',"exp","invalid");if(d.exp<=t-e)throw new m('"exp" claim timestamp check failed',"exp","check_failed")}if(p){let a=t-d.iat;if(a-e>("number"==typeof p?p:W(p)))throw new m('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(a<0-e)throw new l('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return d})(d.protectedHeader,d.payload,c),protectedHeader:d.protectedHeader};return"function"==typeof b?{...e,key:d.key}:e}class Z{_payload;_protectedHeader;_unprotectedHeader;constructor(a){if(!(a instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this._payload=a}setProtectedHeader(a){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=a,this}setUnprotectedHeader(a){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=a,this}async sign(a,b){let c;if(!this._protectedHeader&&!this._unprotectedHeader)throw new p("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!R(this._protectedHeader,this._unprotectedHeader))throw new p("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let d={...this._protectedHeader,...this._unprotectedHeader},e=D(p,new Map([["b64",!0]]),b?.crit,this._protectedHeader,d),j=!0;if(e.has("b64")&&"boolean"!=typeof(j=this._protectedHeader.b64))throw new p('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:k}=d;if("string"!=typeof k||!k)throw new p('JWS "alg" (Algorithm) Header Parameter missing or invalid');C(k,a,"sign");let l=this._payload;j&&(l=f.encode(i(l)));let m=h(c=this._protectedHeader?f.encode(i(JSON.stringify(this._protectedHeader))):f.encode(""),f.encode("."),l),n={signature:i(await O(k,a,m)),payload:""};return j&&(n.payload=g.decode(l)),this._unprotectedHeader&&(n.header=this._unprotectedHeader),this._protectedHeader&&(n.protected=g.decode(c)),n}}class ${_flattened;constructor(a){this._flattened=new Z(a)}setProtectedHeader(a){return this._flattened.setProtectedHeader(a),this}async sign(a,b){let c=await this._flattened.sign(a,b);if(void 0===c.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${c.protected}.${c.payload}.${c.signature}`}}function _(a,b){if(!Number.isFinite(b))throw TypeError(`Invalid ${a} input`);return b}class aa{_payload;constructor(a={}){if(!B(a))throw TypeError("JWT Claims Set MUST be an object");this._payload=a}setIssuer(a){return this._payload={...this._payload,iss:a},this}setSubject(a){return this._payload={...this._payload,sub:a},this}setAudience(a){return this._payload={...this._payload,aud:a},this}setJti(a){return this._payload={...this._payload,jti:a},this}setNotBefore(a){return"number"==typeof a?this._payload={...this._payload,nbf:_("setNotBefore",a)}:a instanceof Date?this._payload={...this._payload,nbf:_("setNotBefore",U(a))}:this._payload={...this._payload,nbf:U(new Date)+W(a)},this}setExpirationTime(a){return"number"==typeof a?this._payload={...this._payload,exp:_("setExpirationTime",a)}:a instanceof Date?this._payload={...this._payload,exp:_("setExpirationTime",U(a))}:this._payload={...this._payload,exp:U(new Date)+W(a)},this}setIssuedAt(a){return void 0===a?this._payload={...this._payload,iat:U(new Date)}:a instanceof Date?this._payload={...this._payload,iat:_("setIssuedAt",U(a))}:"string"==typeof a?this._payload={...this._payload,iat:_("setIssuedAt",U(new Date)+W(a))}:this._payload={...this._payload,iat:_("setIssuedAt",a)},this}}class ab extends aa{_protectedHeader;setProtectedHeader(a){return this._protectedHeader=a,this}async sign(a,b){let c=new $(f.encode(JSON.stringify(this._payload)));if(c.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new q("JWTs MUST NOT use unencoded payload");return c.sign(a,b)}}c(7067),c(4708),c(8474),"undefined"==typeof navigator||navigator.userAgent?.startsWith?.("Mozilla/5.0 "),(0,s.promisify)(e.generateKeyPair)}};